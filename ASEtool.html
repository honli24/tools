<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perovskite ASE Threshold Calculator</title>
    <style>
        :root {
            --primary-color: #007AFF;
            --bg-color: #F5F5F7;
            --card-bg: #FFFFFF;
            --text-main: #1D1D1F;
            --text-secondary: #86868B;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 18px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 550px;
        }

        h2 {
            text-align: center;
            font-weight: 600;
            margin-bottom: 25px;
            color: var(--text-main);
        }

        .section-title {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            margin-top: 20px;
            font-weight: 600;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 16px;
            background-color: #fff;
            box-sizing: border-box; 
            transition: border-color 0.2s;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .note-box {
            background-color: #f9f9f9;
            border-left: 4px solid var(--primary-color);
            padding: 10px;
            margin-top: 5px;
            font-size: 12px;
            color: #555;
            line-height: 1.4;
        }

        .note-title {
            font-weight: bold;
            margin-bottom: 4px;
            display: block;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background-color: #0063d1;
        }

        .result-box {
            margin-top: 30px;
            background-color: #F2F7FF;
            padding: 20px;
            border-radius: 12px;
            display: none; 
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .result-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .result-value {
            font-weight: 700;
            font-size: 18px;
            color: var(--text-main);
        }

        .highlight {
            color: var(--primary-color);
            font-size: 20px;
        }

        .formula-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #ccc;
        }

        .formula-item {
            font-family: "Times New Roman", Times, serif;
            font-style: italic;
            font-size: 15px;
            background: #fff;
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 8px;
            text-align: center;
            color: #333;
        }

        .error {
            color: #FF3B30;
            font-size: 14px;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>⚡ ASE Threshold Calculator</h2>

    <div class="section-title">1. Laser Parameters</div>
    
    <div class="input-group">
        <label>Excitation Wavelength (nm)</label>
        <input type="number" id="wavelength" value="630" placeholder="e.g., 630">
    </div>

    <div class="input-group">
        <label>Power Meter Reading (μW)</label>
        <input type="number" id="power" placeholder="Average power">
    </div>

    <div class="input-group">
        <label>Repetition Rate (Hz)</label>
        <input type="number" id="freq" value="2000">
    </div>

    <div class="input-group">
        <label>Optical Chopper</label>
        <select id="chopper">
            <option value="1" selected>No Chopper (Reading × 1)</option>
            <option value="2">With Chopper (Reading × 2)</option>
        </select>
    </div>

    <div class="section-title">2. Spot Geometry</div>
    
    <div class="input-group">
        <label>Spot Shape</label>
        <select id="shapeSelect" onchange="toggleShapeInputs()">
            <option value="circle">Circle (Diameter)</option>
            <option value="ellipse">Ellipse (Axis Lengths)</option>
            <option value="manual">Manual Input (Area)</option>
        </select>
    </div>

    <div id="input-circle" class="input-group">
        <label>Diameter (μm)</label>
        <input type="number" id="diameter" value="1200" placeholder="e.g., 1200">
    </div>

    <div id="input-ellipse" class="input-group" style="display:none;">
        <label>Major Axis Length (μm)</label>
        <input type="number" id="axis_major" placeholder="Length a">
        <label style="margin-top:8px;">Minor Axis Length (μm)</label>
        <input type="number" id="axis_minor" placeholder="Length b">
    </div>

    <div id="input-manual" class="input-group" style="display:none;">
        <label>Known Area (cm²)</label>
        <input type="number" id="manual_area" placeholder="e.g., 0.002">
    </div>

    <div class="section-title">3. Sample Parameters</div>

    <div class="input-group">
        <label>Film Thickness (Concentration)</label>
        <select id="thicknessSelect" onchange="toggleThicknessInput()">
            <option value="80">0.30 M (~80 nm)</option>
            <option value="95">0.35 M (~95 nm)</option>
            <option value="110" selected>0.40 M (~110 nm)</option>
            <option value="135">0.50 M (~135 nm)</option>
            <option value="custom">Custom Input...</option>
        </select>
    </div>

    <div id="input-thickness-custom" class="input-group" style="display:none;">
        <label>Enter Custom Thickness (nm)</label>
        <input type="number" id="thicknessCustom" placeholder="e.g., 120">
    </div>

    <div class="input-group">
        <label>Measured Absorptance (Abs %)</label>
        <input type="number" id="absorbance" value="18" placeholder="e.g., 18">
        
        <div class="note-box">
            <span class="note-title">Reference Values:</span>
            <b>@ 630 nm:</b> 0.3M (18%) | 0.4M (27%) | 0.5M (41%)<br>
            <b>@ 430 nm:</b> 0.4M (70%) | 0.5M (81%)
        </div>
    </div>

    <p id="error-msg" class="error">Please fill in all required fields!</p>
    <button class="btn" onclick="calculate()">Calculate</button>

    <div class="result-box" id="result-area">
        <div class="section-title" style="margin-top:0; border:none;">Results</div>

        <div class="result-row">
            <span class="result-label">Spot Area (S)</span>
            <span class="result-value"><span id="res-area">0</span> cm²</span>
        </div>

        <div class="result-row">
            <span class="result-label">Incident Threshold (F<sub>in</sub>)</span>
            <span class="result-value"><span id="res-inc-fluence">0</span> μJ/cm²</span>
        </div>

        <div class="result-row" style="background: rgba(0,122,255,0.1); padding: 10px; border-radius: 8px;">
            <span class="result-label" style="color:#007AFF; font-weight:600;">Absorbed Threshold (F<sub>abs</sub>)</span>
            <span class="result-value highlight" id="res-abs-fluence">0</span> 
            <span style="font-weight:bold; color:#007AFF;">μJ/cm²</span>
        </div>

        <div class="result-row" style="margin-top:10px;">
            <span class="result-label">Carrier Density (n<sub>th</sub>)</span>
            <span class="result-value highlight" style="color:#D63384;" id="res-density">0</span> 
            <span style="font-weight:bold; color:#D63384;">cm⁻³</span>
        </div>

        <div class="formula-section">
            <div class="section-title" style="margin-top:0;">Formulas Used</div>
            
            <div class="formula-item">
                F<sub>in</sub> = P/ (Frequency × Area)
            </div>
            <div class="formula-item">
                F<sub>abs</sub> = F<sub>in</sub> × Absorptance
            </div>
            <div class="formula-item">
                n<sub>th</sub> = F<sub>abs</sub> / (E<sub>photon</sub> × d)
            </div>
            <div style="text-align:center; font-size:12px; color:#888; margin-top:8px; line-height:1.6;">
                <b>Where:</b><br>
                P = Power (W), E<sub>photon</sub> = hc/λ, d = Film thickness (cm)<br>
                Chopper Factor: 1 (no chopper) or 2 (with chopper)
            </div>
        </div>
    </div>
</div>

<script>
    function toggleShapeInputs() {
        const shape = document.getElementById('shapeSelect').value;
        
        document.getElementById('input-circle').style.display = 'none';
        document.getElementById('input-ellipse').style.display = 'none';
        document.getElementById('input-manual').style.display = 'none';

        if (shape === 'circle') {
            document.getElementById('input-circle').style.display = 'block';
        } else if (shape === 'ellipse') {
            document.getElementById('input-ellipse').style.display = 'block';
        } else {
            document.getElementById('input-manual').style.display = 'block';
        }
    }

    function toggleThicknessInput() {
        const selectVal = document.getElementById('thicknessSelect').value;
        const customInput = document.getElementById('input-thickness-custom');
        
        if (selectVal === 'custom') {
            customInput.style.display = 'block';
        } else {
            customInput.style.display = 'none';
        }
    }

    function calculate() {
        let lambda = parseFloat(document.getElementById('wavelength').value);
        let power_uW = parseFloat(document.getElementById('power').value);
        let freq = parseFloat(document.getElementById('freq').value);
        let chopper = parseFloat(document.getElementById('chopper').value);
        let abs_percent = parseFloat(document.getElementById('absorbance').value);

        let thickness_nm = 0;
        const thickSelect = document.getElementById('thicknessSelect').value;
        if (thickSelect === 'custom') {
            thickness_nm = parseFloat(document.getElementById('thicknessCustom').value);
        } else {
            thickness_nm = parseFloat(thickSelect);
        }

        let area_cm2 = 0;
        const shape = document.getElementById('shapeSelect').value;

        if (shape === 'circle') {
            let d_um = parseFloat(document.getElementById('diameter').value);
            if (isNaN(d_um)) { showError(); return; }
            let r_cm = (d_um / 2) * 1e-4;
            area_cm2 = Math.PI * Math.pow(r_cm, 2);

        } else if (shape === 'ellipse') {
            let major_um = parseFloat(document.getElementById('axis_major').value);
            let minor_um = parseFloat(document.getElementById('axis_minor').value);
            if (isNaN(major_um) || isNaN(minor_um)) { showError(); return; }
            let a_cm = (major_um / 2) * 1e-4;
            let b_cm = (minor_um / 2) * 1e-4;
            area_cm2 = Math.PI * a_cm * b_cm;

        } else {
            area_cm2 = parseFloat(document.getElementById('manual_area').value);
            if (isNaN(area_cm2)) { showError(); return; }
        }

        if (isNaN(lambda) || isNaN(power_uW) || isNaN(freq) || isNaN(thickness_nm) || isNaN(abs_percent)) {
            showError();
            return;
        }
        hideError();

        const h = 6.626e-34;
        const c = 2.998e8;

        let power_W = power_uW * 1e-6;
        let pulse_energy_J = (power_W * chopper) / freq;

        let fluence_inc_J_cm2 = pulse_energy_J / area_cm2;
        let fluence_inc_uJ_cm2 = fluence_inc_J_cm2 * 1e6;

        let abs_fraction = abs_percent / 100;
        let fluence_abs_J_cm2 = fluence_inc_J_cm2 * abs_fraction;
        let fluence_abs_uJ_cm2 = fluence_abs_J_cm2 * 1e6;

        let photon_E_J = (h * c) / (lambda * 1e-9);

        let thickness_cm = thickness_nm * 1e-7;
        let density = fluence_abs_J_cm2 / (photon_E_J * thickness_cm);

        document.getElementById('result-area').style.display = 'block';
        
        document.getElementById('res-area').innerText = area_cm2.toExponential(3);
        document.getElementById('res-inc-fluence').innerText = fluence_inc_uJ_cm2.toFixed(2);
        document.getElementById('res-abs-fluence').innerText = fluence_abs_uJ_cm2.toFixed(2);
        document.getElementById('res-density').innerText = density.toExponential(2);
    }

    function showError() {
        document.getElementById('error-msg').style.display = 'block';
        document.getElementById('result-area').style.display = 'none';
    }

    function hideError() {
        document.getElementById('error-msg').style.display = 'none';
    }
</script>

</body>
</html>
